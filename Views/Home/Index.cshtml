@model IEnumerable<ExpenseTracker.Models.Transaction>

@{
    ViewData["Title"] = "Home";
    var transactions = Model.ToList();
    var totalIncome = transactions.Where(t => t.Category?.Type == "Income").Sum(t => t.Amount);
    var totalExpense = transactions.Where(t => t.Category?.Type == "Expense").Sum(t => t.Amount);
    var balance = totalIncome - totalExpense;
    var recentTransactions = transactions.Take(6);
    var categorySpending = transactions
        .Where(t => t.Category?.Type == "Expense")
        .GroupBy(t => t.Category?.Title)
        .Select(g => new { Category = g.Key, Amount = g.Sum(t => t.Amount) })
        .OrderByDescending(x => x.Amount)
        .Take(5);
}

<!-- Hero Section -->
<div class="home-hero">
    <div class="hero-overlay">
        <div class="hero-content">
            <div class="hero-badge">üìä Financial Overview</div>
            <h1 class="hero-title">Take Control of Your Finances</h1>
            <p class="hero-subtitle">Track, analyze, and optimize your spending habits</p>
        </div>
    </div>
</div>

<div class="home-container">
    <!-- Financial Overview Cards -->
    <div class="financial-overview">
        <div class="overview-card balance-card">
            <div class="card-top">
                <div class="card-icon-wrapper balance">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="card-trend @(balance >= 0 ? "positive" : "negative")">
                    <i class="fas fa-arrow-@(balance >= 0 ? "up" : "down")"></i>
                    <span>@(balance >= 0 ? "+" : "")@((balance * 100 / (totalIncome > 0 ? totalIncome : 1)).ToString("F1"))%</span>
                </div>
            </div>
            <div class="card-info">
                <h3 class="card-label">Current Balance</h3>
                <div class="card-value @(balance >= 0 ? "positive" : "negative")">‚Çπ@balance.ToString("N0")</div>
                <p class="card-desc">@(balance >= 0 ? "You're doing great!" : "Watch your spending")</p>
            </div>
        </div>

        <div class="overview-card income-card">
            <div class="card-top">
                <div class="card-icon-wrapper income">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="card-badge income">@transactions.Count(t => t.Category?.Type == "Income")</div>
            </div>
            <div class="card-info">
                <h3 class="card-label">Total Income</h3>
                <div class="card-value">‚Çπ@totalIncome.ToString("N0")</div>
                <p class="card-desc">Money received</p>
            </div>
        </div>

        <div class="overview-card expense-card">
            <div class="card-top">
                <div class="card-icon-wrapper expense">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="card-badge expense">@transactions.Count(t => t.Category?.Type == "Expense")</div>
            </div>
            <div class="card-info">
                <h3 class="card-label">Total Expenses</h3>
                <div class="card-value">‚Çπ@totalExpense.ToString("N0")</div>
                <p class="card-desc">Money spent</p>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="home-grid">
        <!-- Recent Transactions -->
        <div class="home-card">
            <div class="card-title-bar">
                <h3>üìã Recent Transactions</h3>
                <a href="/Transaction" class="view-all-link">View All ‚Üí</a>
            </div>
            @if (recentTransactions.Any())
            {
                <div class="transaction-list">
                    @foreach (var item in recentTransactions)
                    {
                        <div class="transaction-item @(item.Category?.Type?.ToLower())">
                            <div class="transaction-left">
                                <div class="transaction-category">@item.Category?.Title</div>
                                <div class="transaction-date">@item.Date.ToString("MMM dd, yyyy")</div>
                            </div>
                            <div class="transaction-amount @(item.Category?.Type?.ToLower())">
                                @(item.Category?.Type == "Income" ? "+" : "-")‚Çπ@item.Amount.ToString("N0")
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="empty-state-small">
                    <p>No transactions yet. Start tracking your finances!</p>
                </div>
            }
        </div>

        <!-- Spending by Category -->
        <div class="home-card">
            <div class="card-title-bar">
                <h3>üìä Top Spending Categories</h3>
            </div>
            @if (categorySpending.Any())
            {
                <div class="category-spending-list">
                    @foreach (var item in categorySpending)
                    {
                        var percentage = totalExpense > 0 ? (item.Amount * 100 / totalExpense) : 0;
                        <div class="spending-item">
                            <div class="spending-info">
                                <span class="spending-category">@item.Category</span>
                                <span class="spending-amount">‚Çπ@item.Amount.ToString("N0")</span>
                            </div>
                            <div class="spending-bar">
                                <div class="spending-progress" style="width: @percentage%"></div>
                            </div>
                            <div class="spending-percentage">@percentage.ToString("F1")%</div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="empty-state-small">
                    <p>No expense data available</p>
                </div>
            }
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <div class="stat-item">
            <div class="stat-icon">üìà</div>
            <div class="stat-content">
                <div class="stat-value">@transactions.Count()</div>
                <div class="stat-label">Total Transactions</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">üè∑Ô∏è</div>
            <div class="stat-content">
                <div class="stat-value">@transactions.Select(t => t.Category?.Title).Distinct().Count()</div>
                <div class="stat-label">Active Categories</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
                <div class="stat-value">@(transactions.Any() ? transactions.Max(t => t.Date).ToString("MMM yyyy") : "N/A")</div>
                <div class="stat-label">Latest Activity</div>
            </div>
        </div>
    </div>
</div>
