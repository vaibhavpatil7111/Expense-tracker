@model IEnumerable<ExpenseTracker.Models.Transaction>

@{
    ViewData["Title"] = "Transactions";
    var transactionList = Model.ToList();
    var totalItems = transactionList.Count;
}

<!-- Hero Section -->
<div class="category-hero">
    <div class="hero-content">
        <h1 class="hero-title">Manage Transactions</h1>
        <p class="hero-subtitle">Track all your income and expenses in one place</p>
    </div>
</div>

<div class="category-container">
    @Html.AntiForgeryToken()

    <!-- Stats Section -->
    @if (totalItems > 0)
    {
        var totalIncome = transactionList.Where(t => t.Category?.Type == "Income").Sum(t => t.Amount);
        var totalExpense = transactionList.Where(t => t.Category?.Type == "Expense").Sum(t => t.Amount);
        var balance = totalIncome - totalExpense;

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <div class="stat-value">‚Çπ@totalIncome.ToString("N0")</div>
                    <div class="stat-label">Total Income</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∏</div>
                <div class="stat-content">
                    <div class="stat-value">‚Çπ@totalExpense.ToString("N0")</div>
                    <div class="stat-label">Total Expense</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-value">‚Çπ@balance.ToString("N0")</div>
                    <div class="stat-label">Balance</div>
                </div>
            </div>
        </div>
    }

    <!-- Action Header -->
    <div class="action-header">
        <div class="header-title">
            <h2>All Transactions</h2>
        </div>
        <div>
            <a asp-action="AddOrEdit" class="btn btn-primary btn-lg">
                <span class="btn-icon">‚ûï</span> Add New Transaction
            </a>
        </div>
    </div>

    @if (totalItems > 0)
    {
        <!-- Table Card -->
        <div class="table-card">
            <div class="table-wrapper">
                <table class="categories-table" id="transactionsTable">
                    <thead>
                        <tr>
                            <th class="col-date sortable" data-column="0">
                                Date <span class="sort-arrow"></span>
                            </th>
                            <th class="col-title sortable" data-column="1">
                                Category <span class="sort-arrow"></span>
                            </th>
                            <th class="col-title sortable" data-column="2">
                                Amount <span class="sort-arrow"></span>
                            </th>
                            <th class="col-title">Note</th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        @foreach (var item in transactionList)
                        {
                            <tr class="category-row">
                                <td>@item.Date.ToString("dd MMM yyyy")</td>
                                <td>
                                    <span class="category-icon">@item.Category?.Icon</span>
                                    <span class="category-title">@item.Category?.Title</span>
                                </td>
                                <td>
                                    <span class="category-badge @(item.Category?.Type == "Income" ? "badge-success" : "badge-danger")">
                                        ‚Çπ@item.Amount.ToString("N0")
                                    </span>
                                </td>
                                <td>@item.Note</td>
                                <td class="action-cell">
                                    <a asp-action="AddOrEdit" asp-route-id="@item.TransactionId" class="btn-action btn-edit" title="Edit">
                                        <span>‚úèÔ∏è</span>
                                    </a>
                                    <button type="button" class="btn-action btn-delete delete-btn" 
                                            data-id="@item.TransactionId" 
                                            data-name="@item.Category?.Title"
                                            title="Delete">
                                        <span>üóëÔ∏è</span>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span>Showing <span id="itemsShown">10</span> of <span id="totalItems">@totalItems</span></span>
                </div>

                <div class="pagination-controls">
                    <button id="prevBtn" class="btn-pagination" onclick="previousPage()">
                        <span>‚Üê Previous</span>
                    </button>

                    <div class="page-indicator">
                        <span>Page <span id="currentPage">1</span> of <span id="totalPages">@((totalItems + 9) / 10)</span></span>
                    </div>

                    <button id="nextBtn" class="btn-pagination" onclick="nextPage()">
                        <span>Next ‚Üí</span>
                    </button>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h3 class="empty-title">No Transactions Yet</h3>
            <p class="empty-description">Start tracking your finances by adding your first transaction.</p>
            <a asp-action="AddOrEdit" class="btn btn-primary btn-lg">
                <span class="btn-icon">‚ûï</span> Add Your First Transaction
            </a>
        </div>
    }
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button type="button" class="modal-close" onclick="closeDeleteModal()">
                <span>‚úï</span>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this transaction?</p>
            <p class="text-warning">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="event.stopPropagation(); confirmDelete();">Delete</button>
        </div>
    </div>
</div>

<script src="~/js/transaction.js" asp-append-version="true"></script>
